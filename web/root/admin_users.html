<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理 - 管理员后台</title>

    <!-- 引入Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- 引入Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- 引入SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- 引入Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* 导航栏 */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-link {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .nav-link:hover {
            background: #f5f5f5;
            color: #667eea;
        }

        /* 主内容区 */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* 卡片样式 */
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .card-header {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background: #f8f9fa;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #e74c3c;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* 按钮样式 */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* 用户表格 */
        .users-table-container {
            overflow-x: auto;
        }

        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .users-table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
        }

        .users-table td {
            padding: 1rem;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .users-table tr:hover {
            background-color: #f8f9fa;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .user-email {
            font-size: 0.875rem;
            color: #666;
        }

        .user-role {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .role-admin {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .role-user {
            background-color: #e8f5e9;
            color: #388e3c;
        }

        .last-login {
            font-size: 0.875rem;
            color: #666;
        }

        /* 分页样式 - 改进 */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-info {
            color: #666;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .page-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            text-align: center;
        }

        .page-btn {
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .page-btn:hover:not(:disabled) {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .page-number {
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0 0.5rem;
        }

        .page-number:hover {
            background: #f8f9fa;
        }

        .page-number.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* 加载动画 */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-container {
            text-align: center;
            padding: 3rem;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* 消息提示 */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .alert-danger {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .alert-success {
            background: #efffef;
            color: #2a7;
            border: 1px solid #cfc;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-links {
                width: 100%;
                justify-content: space-between;
            }

            .card {
                padding: 1.5rem;
            }

            .users-table th,
            .users-table td {
                padding: 0.75rem 0.5rem;
            }

            .user-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .pagination-container {
                flex-direction: column;
                gap: 1rem;
            }
        }

        @media (max-width: 576px) {
            .pagination-controls {
                flex-direction: column;
                gap: 0.75rem;
            }

            .page-numbers {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
<div id="app">
    <div class="container">
        <!-- 导航栏 -->
        <nav class="navbar">
            <a href="/admin/" class="navbar-brand">
                <i class="bi bi-shield-check"></i> 管理员后台
            </a>
            <div class="nav-links">
                <span class="nav-link" style="color: #666;">
                    <i class="bi bi-person-circle"></i> {{ adminInfo.username || '管理员' }}
                </span>
                <a href="/admin/" class="nav-link">
                    <i class="bi bi-house"></i> 返回首页
                </a>
                <button @click="logout" class="btn btn-secondary">
                    <i class="bi bi-box-arrow-right"></i> 退出
                </button>
            </div>
        </nav>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 左侧：添加用户表单 -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-person-plus"></i> 添加用户
                </div>

                <div v-if="addUserError" class="alert alert-danger">
                    {{ addUserError }}
                </div>

                <div v-if="addUserSuccess" class="alert alert-success">
                    {{ addUserSuccess }}
                </div>

                <form @submit.prevent="handleAddUser">
                    <div class="form-group">
                        <label class="form-label">用户名</label>
                        <input
                                v-model="newUser.username"
                                type="text"
                                class="form-control"
                                placeholder="请输入用户名（3-50个字符）"
                                required
                                minlength="3"
                                maxlength="50"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">邮箱</label>
                        <input
                                v-model="newUser.email"
                                type="email"
                                class="form-control"
                                placeholder="请输入邮箱"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">密码</label>
                        <input
                                v-model="newUser.password"
                                type="password"
                                class="form-control"
                                placeholder="请输入密码（至少6个字符）"
                                required
                                minlength="6"
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">确认密码</label>
                        <input
                                v-model="newUser.confirmPassword"
                                type="password"
                                class="form-control"
                                placeholder="请再次输入密码"
                                required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label">用户角色</label>
                        <select v-model="newUser.role" class="form-control">
                            <option value="user">普通用户</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary" :disabled="addingUser">
                        <span v-if="addingUser" class="spinner"></span>
                        {{ addingUser ? '添加中...' : '添加用户' }}
                    </button>
                </form>
            </div>

            <!-- 右侧：用户列表 -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-people"></i> 用户列表
                    <span style="font-size: 0.9rem; color: #666; margin-left: auto;">
                        共 {{ totalUsers }} 位用户
                    </span>
                </div>

                <!-- 加载状态 -->
                <div v-if="loadingUsers" class="loading-container">
                    <div class="spinner" style="width: 2rem; height: 2rem;"></div>
                    <p>加载用户列表中...</p>
                </div>

                <!-- 空状态 -->
                <div v-else-if="users.length === 0" class="empty-state">
                    <i class="bi bi-people empty-state-icon"></i>
                    <h3>暂无用户</h3>
                    <p>添加第一个用户开始管理</p>
                </div>

                <!-- 用户表格 -->
                <div v-else class="users-table-container">
                    <table class="users-table">
                        <thead>
                        <tr>
                            <th>用户</th>
                            <th>角色</th>
                            <th>最后登录</th>
                            <th>注册时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="user in users" :key="user.ID || user.id">
                            <td>
                                <div class="user-info">
                                    <div class="user-avatar">
                                        {{ (user.Username || user.username || '').charAt(0).toUpperCase() || 'U' }}
                                    </div>
                                    <div class="user-details">
                                        <span class="user-name">{{ user.Username || user.username }}</span>
                                        <span class="user-email">{{ user.Email || user.email || '未设置邮箱' }}</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span :class="['user-role', (user.Role || user.role) === 'admin' ? 'role-admin' : 'role-user']">
                                    {{ (user.Role || user.role) === 'admin' ? '管理员' : '普通用户' }}
                                </span>
                            </td>
                            <td>
                                <div class="last-login">
                                    {{ formatDate(user.LastLogin || user.last_login) || '从未登录' }}
                                </div>
                            </td>
                            <td>
                                <div class="last-login">
                                    {{ formatDate(user.CreatedAt || user.created_at) }}
                                </div>
                            </td>
                            <td>
                                <button
                                        @click="confirmDeleteUser(user)"
                                        class="btn btn-danger"
                                        :disabled="deletingUser === (user.ID || user.id)"
                                >
                                    <span v-if="deletingUser === (user.ID || user.id)" class="spinner"></span>
                                    {{ deletingUser === (user.ID || user.id) ? '删除中...' : '删除' }}
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- 改进的分页 -->
                    <div v-if="totalPages > 1" class="pagination-container">
                        <div class="pagination-controls">
                            <button
                                    class="page-btn"
                                    @click="previousPage"
                                    :disabled="currentPage <= 1"
                            >
                                上一页
                            </button>

                            <div class="page-numbers">
                                <span
                                        v-for="page in visiblePages"
                                        :key="page"
                                        :class="['page-number', page === currentPage ? 'active' : '']"
                                        @click="goToPage(page)"
                                >
                                    {{ page }}
                                </span>
                            </div>

                            <button
                                    class="page-btn"
                                    @click="nextPage"
                                    :disabled="currentPage >= totalPages"
                            >
                                下一页
                            </button>
                        </div>

                        <div class="pagination-controls">
                            <div class="page-info">
                                第 {{ currentPage }} 页 / 共 {{ totalPages }} 页
                            </div>

                            <div class="page-input-group">
                                <span style="color: #666;">跳转到:</span>
                                <input
                                        type="number"
                                        v-model="jumpPage"
                                        class="page-input"
                                        :min="1"
                                        :max="totalPages"
                                        @keyup.enter="jumpToPage"
                                >
                                <button
                                        class="page-btn"
                                        @click="jumpToPage"
                                        :disabled="!jumpPage || jumpPage < 1 || jumpPage > totalPages"
                                >
                                    跳转
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, computed } = Vue;

    const app = createApp({
        setup() {
            // 管理员信息
            const adminInfo = ref({});

            // 添加用户表单
            const newUser = ref({
                username: '',
                email: '',
                password: '',
                confirmPassword: '',
                role: 'user'
            });

            const addingUser = ref(false);
            const addUserError = ref('');
            const addUserSuccess = ref('');

            // 用户列表
            const users = ref([]);
            const loadingUsers = ref(true);

            // 分页相关
            const currentPage = ref(1);
            const pageSize = ref(10);
            const totalUsers = ref(0);
            const totalPages = ref(0);
            const jumpPage = ref(1);

            // 删除用户
            const deletingUser = ref(null);

            // 获取管理员信息
            const loadAdminInfo = () => {
                const token = localStorage.getItem('admin_token');
                if (token) {
                    try {
                        // 从JWT token中解析用户信息
                        const payload = JSON.parse(atob(token.split('.')[1]));
                        adminInfo.value = {
                            username: payload.username,
                            role: payload.role
                        };
                    } catch (error) {
                        console.error('解析管理员信息失败:', error);
                    }
                }
            };

            // 格式化日期
            const formatDate = (dateString) => {
                if (!dateString) return '';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    console.error('日期格式化失败:', dateString, error);
                    return '无效日期';
                }
            };

            // 获取用户列表
            const fetchUsers = async (page = 1) => {
                loadingUsers.value = true;
                try {
                    const token = localStorage.getItem('admin_token');
                    if (!token) {
                        console.error('未找到管理员token');
                        window.location.href = '/admin/login.html';
                        return;
                    }

                    // 1. 获取用户列表
                    const response = await axios.get('/api/admin/users', {  // 修改这里
                        params: {
                            page: page,
                            page_size: pageSize.value
                        },
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    console.log('API响应数据:', response.data);

                    // 调试：打印数据结构
                    if (response.data && response.data.Users) {
                        console.log('用户数据结构:', response.data.Users[0]);
                    }

                    // 兼容不同格式的响应
                    const responseData = response.data;

                    // 处理用户数据 - 兼容大小写字段名
                    users.value = responseData.users || responseData.Users || [];
                    totalUsers.value = responseData.total || responseData.Total || 0;
                    totalPages.value = responseData.total_pages || responseData.TotalPages || 1;
                    currentPage.value = responseData.page || responseData.Page || 1;

                    // 更新跳转页面输入框的值
                    jumpPage.value = currentPage.value;

                } catch (error) {
                    console.error('获取用户列表失败:', error);

                    if (error.response) {
                        console.error('错误状态码:', error.response.status);
                        console.error('错误响应:', error.response.data);

                        if (error.response.status === 401) {
                            // Token无效或过期
                            localStorage.removeItem('admin_token');
                            Swal.fire({
                                icon: 'error',
                                title: '登录已过期',
                                text: '请重新登录',
                                timer: 2000
                            }).then(() => {
                                window.location.href = '/admin/login.html';
                            });
                        } else if (error.response.status === 403) {
                            Swal.fire({
                                icon: 'error',
                                title: '权限不足',
                                text: '您没有权限访问此页面'
                            });
                        }
                    } else if (error.request) {
                        console.error('无响应:', error.request);
                        Swal.fire({
                            icon: 'error',
                            title: '网络错误',
                            text: '无法连接到服务器，请检查网络连接'
                        });
                    } else {
                        console.error('请求配置错误:', error.message);
                    }
                } finally {
                    loadingUsers.value = false;
                }
            };

            // 添加用户
            const handleAddUser = async () => {
                if (newUser.value.password !== newUser.value.confirmPassword) {
                    addUserError.value = '两次输入的密码不一致';
                    return;
                }

                addingUser.value = true;
                addUserError.value = '';
                addUserSuccess.value = '';

                try {
                    const token = localStorage.getItem('admin_token');
                    if (!token) {
                        throw new Error('未登录');
                    }

                    // 2. 添加用户
                    const response = await axios.post('/api/admin/users', {  // 修改这里
                        username: newUser.value.username,
                        email: newUser.value.email,
                        password: newUser.value.password,
                        role: newUser.value.role
                    }, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    console.log('添加用户响应:', response.data);

                    addUserSuccess.value = '用户添加成功！';

                    // 清空表单
                    newUser.value = {
                        username: '',
                        email: '',
                        password: '',
                        confirmPassword: '',
                        role: 'user'
                    };

                    // 刷新用户列表，跳转到第一页
                    await fetchUsers(1);

                    // 3秒后清空成功消息
                    setTimeout(() => {
                        addUserSuccess.value = '';
                    }, 3000);

                } catch (error) {
                    console.error('添加用户失败:', error);

                    if (error.response) {
                        const errorMsg = error.response.data?.error ||
                            error.response.data?.message ||
                            '添加用户失败，请重试';
                        addUserError.value = errorMsg;
                    } else {
                        addUserError.value = '网络错误，请检查连接';
                    }
                } finally {
                    addingUser.value = false;
                }
            };

            // 删除用户
            const confirmDeleteUser = (user) => {
                const userId = user.ID || user.id;
                const username = user.Username || user.username;

                Swal.fire({
                    title: '确认删除',
                    html: `确定要删除用户 <strong>${username}</strong> 吗？<br>此操作不可恢复。`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: '删除',
                    cancelButtonText: '取消',
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6'
                }).then((result) => {
                    if (result.isConfirmed) {
                        deleteUser(userId);
                    }
                });
            };

            const deleteUser = async (userId) => {
                deletingUser.value = userId;

                try {
                    const token = localStorage.getItem('admin_token');
                    if (!token) {
                        throw new Error('未登录');
                    }

                    // 3. 删除用户
                    await axios.delete(`/api/admin/users/${userId}`, {  // 修改这里
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    // 刷新用户列表
                    await fetchUsers(currentPage.value);

                    Swal.fire({
                        icon: 'success',
                        title: '删除成功',
                        showConfirmButton: false,
                        timer: 1500
                    });

                } catch (error) {
                    console.error('删除用户失败:', error);

                    let errorMessage = '删除用户失败，请重试';
                    if (error.response?.status === 400 && error.response?.data?.error === '不能删除自己的账户') {
                        errorMessage = '不能删除自己的账户';
                    } else if (error.response?.data?.error) {
                        errorMessage = error.response.data.error;
                    }

                    Swal.fire({
                        icon: 'error',
                        title: '删除失败',
                        text: errorMessage
                    });
                } finally {
                    deletingUser.value = null;
                }
            };

            // 分页导航
            const previousPage = () => {
                if (currentPage.value > 1) {
                    fetchUsers(currentPage.value - 1);
                }
            };

            const nextPage = () => {
                if (currentPage.value < totalPages.value) {
                    fetchUsers(currentPage.value + 1);
                }
            };

            const goToPage = (page) => {
                if (page >= 1 && page <= totalPages.value) {
                    fetchUsers(page);
                }
            };

            // 跳转到指定页面
            const jumpToPage = () => {
                const page = parseInt(jumpPage.value);
                if (!isNaN(page) && page >= 1 && page <= totalPages.value) {
                    fetchUsers(page);
                }
            };

            // 计算可见的页码
            const visiblePages = computed(() => {
                const pages = [];
                const maxVisible = 5;
                let startPage = Math.max(1, currentPage.value - Math.floor(maxVisible / 2));
                let endPage = startPage + maxVisible - 1;

                if (endPage > totalPages.value) {
                    endPage = totalPages.value;
                    startPage = Math.max(1, endPage - maxVisible + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    pages.push(i);
                }

                return pages;
            });

            // 退出登录
            const logout = async () => {
                try {
                    const token = localStorage.getItem('admin_token');
                    if (token) {
                        await axios.post('/api/logout', {}, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                    }
                } catch (error) {
                    console.error('退出登录失败:', error);
                } finally {
                    localStorage.removeItem('admin_token');
                    window.location.href = '/admin/login.html';
                }
            };

            // 页面加载时初始化
            onMounted(() => {
                // 检查是否已登录（管理员）
                const token = localStorage.getItem('admin_token');
                if (!token) {
                    window.location.href = '/admin/login.html';
                    return;
                }

                loadAdminInfo();
                fetchUsers();
            });

            return {
                adminInfo,
                newUser,
                addingUser,
                addUserError,
                addUserSuccess,
                users,
                loadingUsers,
                currentPage,
                totalUsers,
                totalPages,
                jumpPage,
                deletingUser,
                formatDate,
                handleAddUser,
                confirmDeleteUser,
                previousPage,
                nextPage,
                goToPage,
                jumpToPage,
                visiblePages,
                logout
            };
        }
    });

    app.mount('#app');
</script>
</body>
</html>